'use client'

import { useEffect, useState } from 'react'
import { usePathname } from 'next/navigation'
import { capitalize } from '@mui/material'
import { Provider } from 'react-redux'
import StyledComponentsRegistry from '@/app/registry'
import { urbanist } from '@/utils/font'
import 'swiper/css'
import 'swiper/css/scrollbar'

import Header from '@/components/Layout/Header'
import Footer from '@/components/Layout/Footer'
import GlobalStyle from '@/styles/globalStyles'

import BreadCrumbs from '@/components/BreadCrumbs'
import { getUrlForBreadCrumbs } from '@/utils/getUrlForBreadCrumbs'
import { store } from '@/store'

// export const metadata = {
//   title: 'Create Next App',
//   description: 'Generated by create next app',
// }

export default function RootLayout({ children }) {
  const [pages, setPages] = useState([])

  const pathname = usePathname()

  const getCurrentPageName = (page) => {
    switch (page) {
      case 'blog':
        return 'insights'

      default:
        return page
    }
  }

  useEffect(() => {
    const path = getUrlForBreadCrumbs(pathname)

    const pagesArray = path.map((page, i) => ({
      id: i,
      name: page ? capitalize(getCurrentPageName(page)) : 'Home page',
      href: page ? `/${page}` : '/',
    }))
    setPages(pagesArray)
  }, [pathname])

  return (
    <html lang='en'>
      <head>
        <meta name='viewport' content='width=device-width, initial-scale=1.0' />
        <meta name='robots' content='noindex,nofollow' />
      </head>

      <body className={urbanist.className}>
        <Provider store={store}>
          <StyledComponentsRegistry>
            <GlobalStyle />
            <Header />
            {pathname === '/' ? null : <BreadCrumbs pages={pages} />}

            {children}

            <Footer />
          </StyledComponentsRegistry>
        </Provider>
      </body>
    </html>
  )
}
